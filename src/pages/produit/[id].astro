---
import Layout from "../../layouts/Layout.astro";
import ImgPb from "../../components/ImgPb.astro";
import PocketBase from "pocketbase";

// ✅ Fonction requise par Astro
export async function getStaticPaths() {
    const pb = new PocketBase("https://pocketbaseprojets2.mouilleseaux-lhuillier-pierre.fr/",); // ✅ déplacé ici
    const records = await pb.collection("pain").getFullList();

    return records.map((record) => ({
        params: { id: record.id },
        props: { produit: record },
    }));
}

// ✅ Récupération de la donnée passée depuis getStaticPaths
const { produit } = Astro.props;
---

<Layout>
    <section class="py-12 px-4 max-w-5xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
            <div class="rounded overflow-hidden shadow-md">
                <ImgPb
                    record={produit}
                    field="image"
                    alt={produit.nom}
                    classPicture="w-full"
                    classImg="w-full h-auto object-cover"
                />
            </div>

            <div>
                <h1 class="text-4xl font-bold mb-4">{produit.nom}</h1>
                <p class="text-lg text-gray-700 mb-6">{produit.description}</p>

                <div class="mb-3">
                    <span class="font-semibold">Prix :</span>
                    <span class="text-orange-500 font-bold ml-1">
                        {produit.prix_unitaire} €
                    </span>
                </div>

                <div class="mb-3">
                    <span class="font-semibold">Catégorie :</span>
                    <span class="ml-1 capitalize">{produit.categorie}</span>
                </div>

                <a
                    href="/produit"
                    class="inline-block mt-6 bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded"
                >
                    ← Retour aux produits
                </a>
            </div>
        </div>
    </section>
</Layout>
